<!--
Based on:
- http://marcgg.com/blog/2016/11/01/javascript-audio/
- http://alemangui.github.io/blog//2015/12/26/ramp-to-value.html
- https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API
-->

<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Nice Beeps and Notes with Web Audio API and OscillatorNode</title>
    </head>
    <body>
        <p>Based on:</p>
        <ul>
            <li><a href="http://marcgg.com/blog/2016/11/01/javascript-audio/">Generate Sounds Programmatically With Javascript</a></li>
            <li><a href="http://alemangui.github.io/blog//2015/12/26/ramp-to-value.html">Web Audio, the ugly click and the human ear</a></li>
        </ul>

        <p>Click to play random notes</p>

        <script>
            const context = new AudioContext();

            const notes = [ 'C', 'C#', 'D', 'Eb', 'E', 'F', 'F#', 'G', 'G#', 'A', 'Bb', 'B' ];
            const frequencies = [];
            frequencies[ 'C' ] = [ 16.35, 32.70, 65.41, 130.8, 261.6, 523.3, 1047, 2093, 4186 ];
            frequencies[ 'C#' ] = [ 17.32, 34.65, 69.30, 138.6, 277.2, 554.4, 1109, 2217, 4435 ];
            frequencies[ 'D' ] = [ 18.35, 36.71, 73.42, 146.8, 293.7, 587.3, 1175, 2349, 4699 ];
            frequencies[ 'Eb' ] = [ 19.45, 38.89, 77.78, 155.6, 311.1, 622.3, 1245, 2489, 4978 ];
            frequencies[ 'E' ] = [ 20.60, 41.20, 82.41, 164.8, 329.6, 659.3, 1319, 2637, 5274 ];
            frequencies[ 'F' ] = [ 21.83, 43.65, 87.31, 174.6, 349.2, 698.5, 1397, 2794, 5588 ];
            frequencies[ 'F#' ] = [ 23.12, 46.25, 92.50, 185.0, 370.0, 740.0, 1480, 2960, 5920 ];
            frequencies[ 'G' ] = [ 24.50, 49.00, 98.00, 196.0, 392.0, 784.0, 1568, 3136, 6272 ];
            frequencies[ 'G#' ] = [ 25.96, 51.91, 103.8, 207.7, 415.3, 830.6, 1661, 3322, 6645 ];
            frequencies[ 'A' ] = [ 27.50, 55.00, 110.0, 220.0, 440.0, 880.0, 1760, 3520, 7040 ];
            frequencies[ 'Bb' ] = [ 29.14, 58.27, 116.5, 233.1, 466.2, 932.3, 1865, 3729, 7459 ];
            frequencies[ 'B' ] = [ 30.87, 61.74, 123.5, 246.9, 493.9, 987.8, 1976, 3951, 7902 ];


            const highScale = [ frequencies[ 'D' ][ 6 ], frequencies[ 'C' ][ 6 ], frequencies[ 'B' ][ 5 ], frequencies[ 'A' ][ 5 ], frequencies[ 'G' ][ 5 ], frequencies[ 'F#' ][ 5 ], frequencies[ 'E' ][ 5 ], frequencies[ 'D' ][ 5 ] ];
            const midScale = [ frequencies[ 'F#' ][ 4 ], frequencies[ 'E' ][ 4 ], frequencies[ 'D' ][ 4 ], frequencies[ 'C' ][ 4 ], frequencies[ 'B' ][ 3 ], frequencies[ 'A' ][ 3 ], frequencies[ 'G' ][ 3 ], frequencies[ 'F#' ][ 3 ] ];
            const lowScale = [ frequencies[ 'F#' ][ 3 ], frequencies[ 'E' ][ 3 ], frequencies[ 'D' ][ 3 ], frequencies[ 'C' ][ 3 ], frequencies[ 'B' ][ 2 ], frequencies[ 'A' ][ 2 ], frequencies[ 'G' ][ 2 ], frequencies[ 'F#' ][ 2 ] ];

            let type, note, octave;
            function setTypeNoteOctave(){
                type = [ 'sine', 'square', 'triangle', 'sawtooth' ][ Math.random() * 4 | 0 ];
                note = notes[ Math.random() * notes.length | 0 ];
                octave = 1 + Math.random() * 6 | 0;
            }
            setTypeNoteOctave();

            function playNote( type, freq ){
                let gainNode = context.createGain();
                gainNode.connect( context.destination );
                let oscillator = context.createOscillator();
                oscillator.type = type;
                oscillator.frequency.value = freq;
                oscillator.connect( gainNode );
                oscillator.start();

                gainNode.gain.exponentialRampToValueAtTime( 1e-5, context.currentTime + 1.5 );
            }


            document.body.addEventListener( 'click', e => {
                let playedNote = false;

                // play highScale ?
                if( Math.random() < .5 ){
                    playNote( 'sawtooth', highScale[ Math.random() * highScale.length | 0 ] );
                    playedNote = true;
                }

                // play midScale ?
                if( Math.random() < .5 ){
                    playNote( 'square', midScale[ Math.random() * midScale.length | 0 ] );
                    playedNote = true;
                }

                // play lowScale ?
                if( Math.random() < .5 ){
                    playNote( 'triangle', lowScale[ Math.random() * lowScale.length | 0 ] );
                    playedNote = true;
                }

                // play at least one note
                if( ! playedNote ){
                    let n = Math.random();
                    if( n < 1/3 ) playNote( 'sawtooth', highScale[ Math.random() * highScale.length | 0 ] );
                    else if( n < 2/3 ) playNote( 'square', midScale[ Math.random() * midScale.length | 0 ] );
                    else playNote( 'triangle', lowScale[ Math.random() * lowScale.length | 0 ] );
                }

            } );
        </script>
    </body>
</html>
